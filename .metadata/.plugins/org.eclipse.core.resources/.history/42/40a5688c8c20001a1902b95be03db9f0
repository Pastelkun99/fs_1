<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
					"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="multiBoardMapper">
	
	<select id="getArticleListByBoardNo" parameterType="MultiBoardVO" resultType="ArticleVO">
		SELECT B.*
		FROM multiboardtbl A, articletbl B
		WHERE A.board_no = B.board_no AND A.board_no = #{board_no}
		ORDER BY article_parentsno DESC, article_grouporder ASC, article_date DESC
	</select>

	<select id="getArticleCountByBoardNo" parameterType="MultiBoardVO" resultType="ArticleVO">
		SELECT COUNT(*) as cnt 
		from multiboardtbl A, articletbl B 
		WHERE A.board_no = B.board_no AND A.board_no = #{board_no}
	</select>
	
	<select id="getArticleSearchCount" parameterType="PagenationVO" resultType="ArticleVO">
		SELECT COUNT(*) AS cnt FROM multiboardtbl A, articletbl B
		<if test="searchCon == 1">
			WHERE 
					A.board_no = B.board_no 
				AND
					B.article_title LIKE CONCAT('%', #{keyword}, '%') 
				AND 
					B.article_deleteyn = 'N'
				AND A.board_no = #{board_no} 
				ORDER BY B.article_date DESC
		</if>
		<if test="searchCon == 2">
			WHERE 
					A.board_no = B.board_no 
				AND
					B.article_content LIKE CONCAT('%', #{keyword}, '%') 
				AND 
					B.article_deleteyn = 'N' 
				AND A.board_no = #{board_no}
				ORDER BY B.article_date DESC
		</if>
		<if test="searchCon == 3">
			WHERE 
					A.board_no = B.board_no 
				AND
					B.article_writer LIKE CONCAT('%', #{keyword}, '%') 
				AND 
					B.article_deleteyn = 'N' 
				AND A.board_no = #{board_no}
				ORDER BY B.article_date DESC
		</if>
		<if test="searchCon == 4">
			WHERE A.board_no = B.board_no 
			AND 
				B.article_title LIKE CONCAT('%', #{keyword}, '%') 
			OR 
				B.article_content LIKE CONCAT('%', #{keyword}, '%')
			OR 
				B.article_writer LIKE CONCAT('%', #{keyword}, '%')
			AND 
				A.board_no = #{board_no} 
			AND 
				B.article_deleteyn = 'N' 
		</if>
	</select>
	
	<select id="getArticleSearchList" parameterType="PagenationVO" resultType="ArticleVO">
		SELECT B.* FROM multiboardtbl A, articletbl B
		<if test="searchCon == 1">
			WHERE 
				A.board_no = B.board_no
			AND
				B.article_title LIKE CONCAT('%', #{keyword}, '%') AND B.article_deleteyn = 'N'
			AND 
				A.board_no = #{board_no}
			ORDER BY B.article_date DESC LIMIT #{pageCon}, #{pageList}
		</if>
		<if test="searchCon == 2">
			WHERE 
				B.article_content LIKE CONCAT('%', #{keyword}, '%') 
			AND 
				B.article_deleteyn = 'N'
			AND 
				A.board_no = #{board_no} 
			ORDER BY B.article_date DESC LIMIT #{pageCon}, #{pageList}
		</if>
		<if test="searchCon == 3">
			WHERE 
				article_writer LIKE CONCAT('%', #{keyword}, '%') 
			AND 
				B.article_deleteyn = 'N'
			AND 
				A.board_no = #{board_no}
			ORDER BY B.article_date DESC LIMIT #{pageCon}, #{pageList}
		</if>
		<if test="searchCon == 4">
			WHERE B.article_title LIKE CONCAT('%', #{keyword}, '%') 
			OR B.article_content LIKE CONCAT('%', #{keyword}, '%')
			OR B.article_writer LIKE CONCAT('%', #{keyword}, '%')
			AND A.board_no = #{board_no} 
			AND B.article_deleteyn = 'N' LIMIT #{pageCon}, #{pageList}
		</if>
	</select>
	
	<select id="getArticleOne" parameterType="int" resultType="ArticleVO">
		SELECT * FROM ARTICLETBL WHERE article_no = #{article_no}
	</select>
	
	<update id="articleHitUpdate" parameterType="int">
		UPDATE ARTICLETBL SET article_hit = article_hit + 1 WHERE article_no = #{article_no}
	</update>
</mapper>