<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
					"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="analysisMapper">

	<select id="getAnalysisInfo" parameterType="int" resultType="com.fusion1.dao.InfoVO">
		SELECT * FROM INFOTBL WHERE a_no = #{no}
	</select>
	
	<select id="getAnalysisInfoList" resultType="com.fusion1.dao.InfoVO">
		SELECT * FROM INFOTBL
	</select>
	
	<select id="getSelectList" resultType="com.fusion1.dao.SelectVO">
		SELECT * FROM SELECTTBL
	</select>
	
	<select id="getAnalysisQuestionList" resultType="com.fusion1.dao.AnalysisDAO">
		<![CDATA[
		SELECT * FROM QUESTIONTBL WHERE a_no = #{a_no}
		]]>
	</select>
	
	<select id="getQuestionInfo" parameterType="com.fusion1.dao.QuestionVO" resultType="com.fusion1.dao.QuestionVO">
		SELECT * FROM QUESTIONTBL WHERE a_no = #{a_no} AND q_no = #{q_no}
	</select>
	
	<select id="getAnalysisSelectList" resultType="com.fusion1.dao.AnalysisDAO">
		SELECT * FROM QUESTIONTBL LEFT JOIN SELECTTBL ON QUESTIONTBL.q_selection = SELECTTBL.q_selection ORDER BY QUESTIONTBL.q_no, SELECTTBL.q_order;
	</select>
	
	<select id="getAnalysisAnswerList" parameterType="com.fusion1.dao.AnswerVO" resultType="com.fusion1.dao.AnswerVO">
		SELECT * FROM ANSWERTBL WHERE q_id = #{q_id} AND a_no = #{a_no}
	</select>
	
	<select id="getAnalysisAnswer" parameterType="com.fusion1.dao.AnswerVO" resultType="com.fusion1.dao.AnswerVO">
		SELECT * FROM ANSWERTBL WHERE q_no = #{q_no} AND a_isetc = #{a_isetc} AND q_id=#{q_id}
	</select>
	
	<select id="getAnalysisAnswerMulti" parameterType="String" resultType="com.fusion1.dao.AnswerVO">
		SELECT * FROM ANSWERTBL WHERE q_id = #{q_id} ORDER BY a_number DESC limit 2
	</select>
	
	<insert id="inputAnalysisAnswer" parameterType="com.fusion1.dao.AnswerVO" >
		INSERT INTO ANSWERTBL VALUES (0, #{a_no}, #{q_no}, #{q_id}, #{q_selection}, #{q_value}, #{a_order}, #{a_value}, #{a_isetc})
	</insert>
	
	<update id="inputAnalysisUpdate" parameterType="com.fusion1.dao.AnswerVO">
		UPDATE ANSWERTBL SET q_value = #{q_value}, a_value = #{a_value} WHERE q_no = #{q_no} AND a_order = #{a_order}
	</update>
	
	<delete id="deleteAnswer" parameterType="com.fusion1.dao.AnswerVO">
		DELETE FROM ANSWERTBL WHERE q_no = #{q_no} AND a_isetc = #{a_isetc}
	</delete>
	
	<insert id="userAnalysisComplete" parameterType="com.fusion1.dao.AnswerVO">
		INSERT INTO ANALYSISTBL VALUES (0, 1, #{q_id}, 1)
	</insert>
	
	<select id="userAnalysisConfirm" parameterType="com.fusion1.dao.AnswerVO" resultType="com.fusion1.dao.AnswerVO">
		SELECT * FROM ANALYSISTBL WHERE q_id = #{q_id}
	</select>
	
	<update id="updateQuestion" parameterType="com.fusion1.dao.QuestionVO">
		UPDATE QUESTIONTBL SET 
							   q_subject = #{q_subject},
							   q_value = #{q_value},
							   q_type = #{q_type},
							   q_selection = #{q_selection},
							   q_page = #{q_page},
							   q_parentno = #{q_parentno}
						WHERE a_no = #{a_no} AND q_no = #{a_no}
								
	</update>
	
	<select id="getSelectionList" resultType="com.fusion1.dao.SelectVO">
		SELECT DISTINCT q_selection FROM SELECTTBL 
	</select>
	
	<insert id="appendQuestion" parameterType="com.fusion1.dao.QuestionVO">
		INSERT INTO QUESTION VALUES ()
	</insert>

</mapper>